<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Esensorics test prototype</title>
  <link rel="stylesheet" href="https://code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
  <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
  <script src="https://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
  <link rel="stylesheet" href="style.css">
  <script>
var item_instances = 4;
  $(function() {   
   
 //vocabulary for autocompelete
      var availableTags = [
      "Sweet",
      "savory",
      "salty",
      "bitter",
      "tart",
      "smoky",
      "rancid",
      "spicy",
      "hot",
      "creamy",
      "crumbly",
      "crunchy",
      "greasy",
      "gooey",
      "moist",
      "mushy",
      "Perl",
      "PHP",
      "Python",
      "Ruby",
      "Scala",
      "Scheme"
    ];
//adding autocomplete to axis names      
    $( ".axis_name" ).autocomplete({
      source: availableTags
    });      

      
      
 // this pice hides the tag window when we click somewhere else 
    $(document).click(function() {
        $(".add_tag_layer").hide();
});
$(".add_tag_layer").click(function(e) {
    e.stopPropagation(); 
    return false;        
                        
});  

      
//here I make N number of instances of draggable item
var N = item_instances;
 //make first item dragable
$("#draggable_item1").draggable({containment: "#drag_window", snap: "#canvas", snapMode: "inner", snapTolerance: 32});
      
for(cloneCount = 2 ; cloneCount <= N; cloneCount++){
//previous item
var prev_id= 'draggable_item'+ (cloneCount-1);
//creat new item and edit id
 var new_item = $("#draggable_item1").clone().attr('id', 'draggable_item'+ cloneCount);
//add new item after prevois one  
 new_item.insertAfter(document.getElementById(prev_id));
//make item dragable
new_item.draggable({containment: "#drag_window", snap: "#canvas", snapMode: "inner", snapTolerance: 32});
//
    
}
      
      
//////////////////////////////////////////////////////////      
 
      x1 =1;
      y1=1;
	  $( "#drag_window" ).droppable({
  drop: function(event,ui) {
    
      if(true){
    $(ui.draggable).animate({ top: y1, left:x1},400);
     // var draggableId = ui.draggable.attr("id");
       $(ui.draggable).effect( "bounce", 
          {times:3}, 300 );
      
      }
  }
        
});
//***********************     
      
       $( "#canvas" ).droppable({
                  greedy: true
});
//*********************      
      $("#ax_b, #ax_t, #ax_l, #ax_r").keyup(function(){
   $(this).css({'background-color' : '#BEF781'});
});
//************************    
        $( "#canvas" ).droppable({
  drop: function(event,ui) {
    var top= $( "#ax_t" ).val();
    var bott= $( "#ax_b" ).val();
     var left = $( "#ax_l" ).val();
     var right= $( "#ax_r" ).val();
      
   //to be replaced by a condition about axis   
      if((top == "") || (bott == "") ||(left == "")||(right == "")){
       axis_shake();
                      
     
    $(ui.draggable).animate({ top: y1, left:x1},400);
     // var draggableId = ui.draggable.attr("id");
       $(ui.draggable).effect( "bounce", 
          {times:3}, 300 );
      
      }
  }
        
});

  });
      
 //******************
 //the function that is activated after "submit botton is pressed"   
      function submit_function( ){
        var alert_text="submitted sucsessfully!";
//check if axis have names          
          var top= $( "#ax_t" ).val();
          var bott= $( "#ax_b" ).val();
          var left = $( "#ax_l" ).val();
          var right= $( "#ax_r" ).val();
        
      if((top == "") || (bott == "") ||(left == "")||(right == "")){
          axis_shake();
      alert_text="You need to name the axis and place the items in the canvas, before you be able to submit!";
      }else{

       
          
//if there are elements out of canvas 
var items_out = check_items_onCanvas();
           
if (items_out.length > 0 ){
    
 for(i = 0; i< items_out.length; i++ ){
     var id = "#" + items_out[i];
     $(id).effect( "bounce",{times:3}, 300 );
 } 
 
alert_text = "Please locate all the items on the canvas before submition!";

}
     
      }
          
       alert(alert_text);
}
          
//************************   
//check if all samples are in canvas and return the ones who are not
 function check_items_onCanvas() {
    var items_out = []; 
    
     var position = getPosition(document.getElementById("canvas"));
 cx=position.x;
  cy=position.y;       
for(cloneCount = 1 ; cloneCount <= item_instances; cloneCount++){ 
    var current_id= 'draggable_item'+ cloneCount;
    var current_item = document.getElementById(current_id);
    //get items position
 position = getPosition(current_item);
 x=position.x;
 y=position.y;
   if(x < cx){ items_out.push(current_id);
             }
}
     
return items_out;
 }
//****************************      
 //function that checks if axis have name if not shake the lable and change color
 function axis_shake(){
  var top= $( "#ax_t" ).val();
    var bott= $( "#ax_b" ).val();
     var left = $( "#ax_l" ).val();
     var right= $( "#ax_r" ).val();
     
  if(bott == ""){
          $("#ax_b").css({'background-color' : '#FFBF00'});
          $("#ax_b").effect( "bounce", 
          {times:2}, 300 );
          $("#ax_b").focus();
          }   
          if(left == ""){
          $("#ax_l").css({'background-color' : '#FFBF00'});
          $("#ax_l").effect( "bounce", 
          {times:2}, 300 );
          $("#ax_l").focus();

          }   
          if(right == ""){
          $("#ax_r").css({'background-color' : '#FFBF00'});
          $("#ax_r").effect( "bounce", 
          {times:2}, 300 );
          $("#ax_r").focus();

          } 
          if(top == ""){
          $("#ax_t").css({'background-color' : '#FFBF00'});
          $("#ax_t").effect( "bounce", 
          {times:2}, 300 );
          $("#ax_t").focus();
          }  
 
 
 }     
      
      
//get position      
 function getPosition(element) {
    var xPosition = 0;
    var yPosition = 0;
  
    while(element) {
        xPosition += (element.offsetLeft - element.scrollLeft + element.clientLeft);
        yPosition += (element.offsetTop - element.scrollTop + element.clientTop);
        element = element.offsetParent;
    }
    return { x: xPosition, y: yPosition };
}   
//************************         
          
          
  </script>
</head>
<body>

 <div id="drag_window">

  <div id="leftinfo">
    <div id="h1">
<h1>Candy Test</h1>
</div>
  <div id="p">
<p>This could be the place for help text. The tasting is done simultaneously with placing the samples.</p>
</div>
<div id="items">
	<div id="draggable_item1" class="draggable_content">
	  <p id="title1">Sample 1</p>
	  <p id="add_tag_link1"><a href="javascript:this.toggle();$('#add_tag_newtag1').focus();">Tag</a></p>
	  <div id="add_tag_layer1" class="add_tag_layer">
	  	<input id="add_tag_newtag1" type="text" value="" />
	  	<input type="button" name="tag" class="add_tag_layer_button" value="Add" onclick="javascript:$('#add_tag_link1').html('(' + $('#add_tag_newtag1').val() + ') <a href=&quot;javascript:$(\'#add_tag_layer1\').toggle();&quot;><img src=&quot;img/icon_edit.png&quot; width=&quot;10&quot; /></a>'); $('#add_tag_layer1').toggle();" />
	  </div>
	</div>

</div> 
      

     <button  type="button" id="submitbutton" onclick="submit_function()">Submit</button> 
    
  </div> 
  
      


  <div id="rightinfo">
    <div id="canvas">
    	<script type="text/javascript">
      //$('#canvas').html('canvas: '+samplesList[2]['name']);
	</script>
	<div id="axis_horisontal"></div>
	<div id="axis_vertical"></div>
  
	<div id="axisname_top">
<input class="axis_name" id="ax_t" type="text" placeholder="Name this axis" size="13" maxlength="13"><br>
</div>  

  <div id="axisname_bottom">
<input class="axis_name" id="ax_b" type="text" placeholder="Name this axis" size="13" maxlength="13"><br>
</div>

	<div id="axisname_left">

<input class="axis_name" id="ax_l" type="text" placeholder="Name this axis" size="13" maxlength="13"><br>
</div>

	<div id="axisname_right" >
    <input class="axis_name" id="ax_r" type="text" placeholder="Name this axis" size="13" maxlength="13"><br>
  </div>
</div>
</div>
</div>

 
</body>
</html>

